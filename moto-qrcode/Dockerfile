# ============================
# STAGE 1: BUILD (MAVEN + JDK)
# ============================
FROM maven:3.9-eclipse-temurin-21 AS build

# Pasta de trabalho dentro da imagem
WORKDIR /app

# Copia apenas o pom primeiro (cache de depend√™ncias)
COPY pom.xml .

# Baixa depend√™ncias (sem compilar o projeto ainda)
RUN mvn -B -q dependency:go-offline

# Agora copia o c√≥digo-fonte
COPY src ./src

# Gera o JAR (sem rodar testes pra ficar mais r√°pido)
RUN mvn -B clean package -DskipTests

# ============================
# STAGE 2: RUNTIME (JRE)
# ============================
FROM eclipse-temurin:21-jre-alpine

# Pasta onde o app vai rodar
WORKDIR /app

# Copia o JAR gerado no stage de build
# üëâ CONFERE SE O NOME DO JAR EST√Å IGUAL AO QUE O MAVEN GERA
COPY --from=build /app/target/moto-qrcode-0.0.1-SNAPSHOT.jar app.jar

# Porta padr√£o do Spring Boot
EXPOSE 8080

# Vari√°veis de ambiente (pode sobrescrever no Render depois)
ENV JAVA_OPTS=""

# Comando de inicializa√ß√£o
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
