
# API REST ‚Äî Cadastro de Motos via QR Code (Sprint 3 ‚Ä¢ Mottu) ‚Äî **Com Usu√°rios, Login e Logout**

Aplica√ß√£o da disciplina **Java Advanced** usando **Spring Boot 3**, **Thymeleaf**, **Flyway** e **Oracle**.
Permite **cadastrar motos manualmente** ou **via QR Code**, **gerenciar √°reas** e **controlar acesso por usu√°rio** (login por formul√°rio).

---

## Banco de Dados (Oracle FIAP)

**Conex√£o usada pelo projeto (j√° no `application.properties`):**
- **URL:** `jdbc:oracle:thin:@oracle.fiap.com.br:1521:ORCL`
- **Usu√°rio:** `rm554557`
- **Senha:** `fiap25`

### Estrutura de tabelas (migrations Flyway)

As migrations ficam em `src/main/resources/db/migration` e s√£o executadas **automaticamente** ao iniciar a aplica√ß√£o.

**V2__create_area.sql**
```sql
CREATE TABLE T_MOTTU_AREA (
  ID_AREA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  NM_AREA VARCHAR2(100) UNIQUE NOT NULL
);
```

**V3__create_moto.sql**
```sql
CREATE TABLE T_MOTTU_MOTO (
  ID_MOTO   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  DS_PLACA  VARCHAR2(20) UNIQUE NOT NULL,
  NM_MODELO VARCHAR2(100) NOT NULL,
  ID_AREA   NUMBER NOT NULL,
  CONSTRAINT FK_MOTO_AREA FOREIGN KEY (ID_AREA) REFERENCES T_MOTTU_AREA(ID_AREA)
);
```

**V4__insert_areas.sql**
```sql
INSERT INTO T_MOTTU_AREA (NM_AREA) VALUES ('Centro');
INSERT INTO T_MOTTU_AREA (NM_AREA) VALUES ('Zona Norte');
INSERT INTO T_MOTTU_AREA (NM_AREA) VALUES ('Zona Sul');
INSERT INTO T_MOTTU_AREA (NM_AREA) VALUES ('Zona Leste');
INSERT INTO T_MOTTU_AREA (NM_AREA) VALUES ('Zona Oeste');
```

> A tabela **`USUARIO`** √© criada na primeira execu√ß√£o via JPA (por causa de `spring.jpa.hibernate.ddl-auto=update`).  
> Campos: `id`, `username` (√∫nico), `password`, `role` (`ADMIN`|`USER`), `email`, `nome`.

---

## Como rodar LOCAL

1) Requisitos: **JDK 17** e **Maven 3.9+**.  
2) No m√≥dulo do projeto:
```bash
cd moto-qrcode
mvn clean spring-boot:run
```
3) A aplica√ß√£o sobe em **http://localhost:8080** e o **Flyway** cria/popula as tabelas (V1..V4).

**Configura√ß√£o efetiva:**
```properties
spring.datasource.url=jdbc:oracle:thin:@oracle.fiap.com.br:1521:ORCL
spring.datasource.username=rm554557
spring.datasource.password=fiap25

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
server.port=8080
```

---

## Usu√°rios, Login e Logout

- **Login:** `http://localhost:8080/login` (formul√°rio).  
- **Logout:** `http://localhost:8080/logout`.
- **Perfis:** `ADMIN` e `USER`.

> **Encoder atual:** `NoOpPasswordEncoder` (modo acad√™mico). **Senha em texto puro.**  
> Use o usuario "admin" e a senha "123"

### Endpoints de Usu√°rios (`/api/usuarios`)

| M√©todo | Endpoint               | Descri√ß√£o            |
|------: |------------------------|----------------------|
| GET    | `/api/usuarios`       | üîç Lista usu√°rios    |
| POST   | `/api/usuarios`       | ‚úÖ Cria usu√°rio      |
| PUT    | `/api/usuarios/{id}`  | üîÑ Atualiza usu√°rio  |
| DELETE | `/api/usuarios/{id}`  | ‚ùå Remove usu√°rio    |

**JSON (criar ADMIN via API):**
```json
{
  "username": "admin",
  "password": "admin",
  "role": "ADMIN",
  "email": "admin@mottu.com",
  "nome": "Administrador"
}
```

**JSON (criar USER):**
```json
{
  "username": "operador",
  "password": "123456",
  "role": "USER",
  "email": "operador@mottu.com",
  "nome": "Operador"
}
```

> **P√°ginas Thymeleaf**:  
> `/usuarios-page` (CRUD de usu√°rios), `/areas-page`, `/motos-page`, `/qrcode` (scanner web), `/` (home).  
> Na apresenta√ß√£o, mantenha a p√°gina de usu√°rios **restrita ao ADMIN**.

---

## Como usar o QR Code

> **Antes:** selecione uma **√Årea Ativa** (veja endpoints de √Åreas).

### Scanner **Web** (na pr√≥pria app)
1. Abra `http://localhost:8080/qrcode` e permita a c√¢mera.  
2. Gere um QR com este **JSON exato**:  
   ```json
   { "placa": "PROF5678", "modelo": "BMW GS 1200" }
   ```
3. Ao ler, √© feito **POST** para `http://localhost:8080/api/motos/qrcode` e a moto √© criada na **√Årea Ativa**.

---

## Endpoints da API

### √Åreas (`/api/areas`)
| M√©todo | Endpoint                       | Descri√ß√£o                                                                 |
|------: |--------------------------------|----------------------------------------------------------------------------|
| GET    | `/api/areas`                   | üîç Lista √°reas                                                             |
| POST   | `/api/areas`                   | ‚úÖ Cria √°rea                                                               |
| POST   | `/api/areas/selecionar/{id}`   | ‚úÖ Define a **√Årea Ativa** (obrigat√≥rio antes do QR)                       |
| GET    | `/api/areas/ativa`             | üîç Retorna a **√Årea Ativa**                                                |

### Motos (`/api/motos`)
| M√©todo | Endpoint                 | Descri√ß√£o                                                      |
|------: |--------------------------|----------------------------------------------------------------|
| GET    | `/api/motos`            | üîç Lista motos                                                 |
| POST   | `/api/motos`            | ‚úÖ Cadastra **manual** (`placa`, `modelo`, `idArea`)           |
| POST   | `/api/motos/qrcode`     | ‚úÖ Cadastra **via QR** (usa a **√Årea Ativa**)                  |
| PUT    | `/api/motos/{id}`       | üîÑ Atualiza dados da moto                                      |
| DELETE | `/api/motos/{id}`       | ‚ùå Deleta moto                                                 |

**JSON de exemplo (motos):**
- **Cadastro manual** (`POST /api/motos`):
```json
{ "placa": "XYZ1234", "modelo": "Honda CG", "idArea": 1 }
```
- **Cadastro via QR** (`POST /api/motos/qrcode`):
```json
{ "placa": "XYZ5678", "modelo": "Honda CG" }
```
- **Atualizar** (`PUT /api/motos/{id}`):
```json
{ "placa": "XYZ9999", "modelo": "Honda CG Titan", "idArea": 1 }
```

---

## Fluxo correto de uso (resumo)

1. **Rodar a aplica√ß√£o** (Flyway cria/popula tabelas).  
3. **Selecionar √Årea Ativa**: `POST /api/areas/selecionar/{id}`.  
4. **Cadastrar motos** via `POST /api/motos` (manual) **ou** `POST /api/motos/qrcode` (QR).  
5. **Gerenciar usu√°rios** em `/usuarios-page` (ADMIN).

---

## Desenvolvido por
- **RM 556293** ‚Äî Alice Teixeira Caldeira  
- **RM 555708** ‚Äî Gustavo Goulart  
- **RM 554557** ‚Äî Victor Medeiros
